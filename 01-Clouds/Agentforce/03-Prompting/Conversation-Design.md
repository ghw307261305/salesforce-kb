# 会話設計ガイド（Conversation Design）

## 1) 目的

このドキュメントは Agentforce の会話体験を一貫して設計するための基準を定義する。
対象は「意図判定」「確認質問」「Action 実行」「失敗時フォールバック」「人手引継ぎ」。

## 2) 設計原則

- 結論先行: 先頭で要点を返す。
- 最小往復: 必須情報だけ確認し、不要な質問をしない。
- 非推測: 不明データは作らず、確認または拒否・引継ぎを選択する。
- 安全優先: 禁止領域は明確に拒否し、代替案を示す。
- 可観測性: 重要判断（意図、Action、拒否理由）をログ化する。

## 3) 会話ステートモデル

| ステート | 目的 | 遷移条件 |
| --- | --- | --- |
| `intent_detect` | ユーザー意図の判定 | 意図が確定したら `slot_collect` |
| `slot_collect` | 必須入力の収集 | 必須入力充足で `execute_action` |
| `execute_action` | Action 呼び出し | 成功で `respond`、失敗で `recover` |
| `recover` | 失敗時の再試行/代替提示 | 回復不能なら `handoff` |
| `handoff` | 人手対応へ引継ぎ | 引継ぎ情報提示後終了 |
| `respond` | 最終応答を返す | 応答後終了 |

## 4) スロット収集方針

- 必須スロットと任意スロットを明確に分離する。
- 一度に聞く項目は最大2件までに制限する。
- 既知値（セッション、ユーザー属性、直前応答）は再質問しない。

例（ケース起票）:

- 必須: `account_id`, `subject`, `description`
- 任意: `priority`, `preferred_contact`

## 5) 確認質問テンプレート

### 5.1 必須情報不足

- 「手続きを進めるために、{field} を教えてください。」

### 5.2 曖昧な要求

- 「{optionA} と {optionB} のどちらをご希望ですか。」

### 5.3 権限不足

- 「この操作は現在の権限では実行できません。担当窓口へ引き継ぎますか。」

## 6) Action 実行時の対話ルール

1. 実行前に入力妥当性を確認する。
2. 実行意図を短く宣言する（例: 「ケース状況を確認します。」）。
3. 結果は「結論 + 根拠 + 次アクション」で返す。
4. 失敗時は内部エラーを露出せず、ユーザー向け文面へ変換する。

## 7) フォールバック設計

| 失敗種別 | ユーザー向け応答 | 次の処理 |
| --- | --- | --- |
| 入力不足 | 不足項目を具体的に確認 | `slot_collect` へ戻す |
| 権限不足 | 実行不可理由を説明 | `handoff` 提案 |
| 外部障害 | 一時障害を案内 | 再試行または `handoff` |
| ポリシー違反要求 | 明確に拒否 | 安全な代替案提示 |

## 8) 人手引継ぎ（Handoff）

引継ぎ時は以下を必須とする。

- 引継ぎ理由
- 収集済み情報サマリ
- 優先度（severity）
- 参照ID（ticket_ref）

ユーザーには「現在の状態」と「次に誰が対応するか」を明示する。

## 9) 文体・ローカライズ方針

- 既定言語: 日本語
- 文章長: 1回答あたり 3〜7 行を目安
- トーン: 丁寧、簡潔、断定的（曖昧表現を避ける）
- 専門語: 初回のみ簡単な補足を付与

## 10) 会話設計レビュー観点

- 意図ごとに成功条件が定義されているか
- 必須入力が不足なく定義されているか
- 失敗時の分岐（再試行/引継ぎ）が明確か
- 禁止要求に対する拒否文面が定義されているか
- 主要シナリオがテストケース化されているか

## 11) 関連ドキュメント

- [Prompt-Structure-v1](./Prompt-Structure-v1.md)
- [Topic 設計実例](../02-Build-HowTo/Topics/Topic-Design-Case-Assistant-v1.md)
- [Action 設計テンプレート](../02-Build-HowTo/Actions/Action-Design-Template.md)
- [Test-Strategy](../02-Build-HowTo/Testing/Test-Strategy.md)
- [Terminology](../01-Concepts/Terminology.md)

## 12) 変更履歴

| 日付 | 版 | 変更内容 | 作成者 |
| --- | --- | --- | --- |
| 2026-02-26 | v1 | 初版作成（ステートモデル、確認質問、フォールバック） |  |
