# 第10章 发布管理与回滚策略

- 版本: v1
- 最后更新: 2026-02-28
- 章节定位: 上线治理核心
- 预计学习时长: 120-150 分钟

## Summary

本章目标是让 Agentforce 发布“可控可退”。  
重点是将发布动作标准化为检查、门禁、执行、回滚、复盘五步。

完成本章后，学习者应能:

1. 构建 Go-Live 检查清单。
2. 设定清晰的 Go/No-Go 门禁。
3. 在故障场景下执行可验证的回滚。

## Decision / Changes

1. 采用“发布窗口+角色签字”机制，避免隐式上线。
2. 把回滚演练列为发布前必做项。
3. 将发布后24小时观察定义为强制阶段。

## 1. 学习目标

### 1.1 知识目标

1. 理解 Agentforce 发布风险来源（配置、权限、数据、外部依赖）。
2. 理解发布门禁与质量指标关系。
3. 理解回滚触发条件与执行步骤。

### 1.2 技能目标

1. 能设计并执行上线检查表。
2. 能根据门禁指标给出 Go/No-Go 决策。
3. 能组织回滚演练并完成证据留档。

### 1.3 交付目标

1. 一份发布计划与窗口信息表。
2. 一份 Go-Live checklist。
3. 一份回滚 runbook 与签字记录。

## 2. 前置知识

1. 第8章测试门禁结果。
2. 第9章观测和告警准备。
3. 基础变更管理流程。

## 3. 发布流程框架

### 3.1 五阶段发布流程

1. Pre-Go-Live：检查依赖与门禁证据。
2. Go/No-Go：评审与签字。
3. Release Execution：窗口内发布与冒烟。
4. Post-Go-Live：24小时稳定性观察。
5. Retrospective：复盘与改进。

### 3.2 角色职责

| 角色 | 责任 |
| --- | --- |
| Release Owner | 组织发布与决策 |
| Tech Lead | 技术风险评估 |
| Security | 安全与权限核验 |
| Business Owner | 业务可用性确认 |
| On-Call | 发布期间故障响应 |

## 4. Go/No-Go 门禁

### 4.1 必达指标

1. Blocker/High = 0
2. 安全P0 = 0
3. 必测通过率 >= 95%
4. Hallucination <= 2%
5. p95 <= 8s

### 4.2 发布阻断项

1. 回滚脚本未演练。
2. 权限矩阵未验证。
3. 关键依赖（外部系统、数据源）不可用。

## 5. 回滚策略

### 5.1 回滚触发条件

| 条件 | 触发级别 |
| --- | --- |
| 安全违规/越权泄露 | 立即回滚（P0） |
| 核心路径不可用 >10分钟 | 回滚（P1） |
| 关键动作失败率 >10% 持续15分钟 | 回滚（P1） |

### 5.2 回滚步骤

1. 关闭新版本开关/激活。
2. 恢复上一稳定配置（Topic/Prompt/Action）。
3. 执行冒烟验证。
4. 发布回滚通知并记录事件。

### 5.3 回滚后动作

1. 生成 incident 记录。
2. 开启根因分析。
3. 回灌测试集并制定修复计划。

## 6. 发布执行与验证

### 6.1 发布窗口执行清单

1. 启用目标配置。
2. 执行 3 条核心冒烟路径。
3. 验证安全拒绝路径。
4. 监控首小时关键指标。

### 6.2 发布后24小时观察

| 指标 | 阈值 |
| --- | --- |
| action_success_rate | >= 90% |
| timeout_rate | <= 3% |
| escalation_rate | <= 30% |
| policy_violation | 0 |

## 7. 实操练习（必做 + 可选）

### 7.1 必做练习: 完成一次模拟发布

任务:

1. 使用发布检查表完成预检查。
2. 组织一次 Go/No-Go 评审。
3. 模拟触发回滚并执行全流程。

预期结果: 形成完整发布证据包。

### 7.2 可选练习: 发布风险登记

任务:

1. 识别 10 个发布风险点。
2. 定义概率、影响和缓解动作。
3. 形成风险登记表。

预期结果: 发布风险基线 v1。

## 8. 常见错误与排障

| 问题 | 现象 | 修正建议 |
| --- | --- | --- |
| 无发布冻结窗口 | 临时变更混入 | 发布前冻结变更 |
| 回滚未演练 | 事故时回退失败 | 发布前强制演练 |
| 无签字机制 | 决策责任不清 | 固化角色签字 |
| 只看功能忽略安全 | 上线后违规风险高 | 增加安全门禁 |

## 9. 练习题

### 9.1 选择题

1. 下列哪项应视为发布阻断项？
   - A. 文档排版不统一
   - B. 回滚脚本未演练
   - C. 培训未完成
   - D. 目录未优化
2. 哪个阶段主要确认首小时稳定性？
   - A. Pre-Go-Live
   - B. Go/No-Go
   - C. Post-Go-Live
   - D. Retrospective
3. 发生安全P0时正确动作是：
   - A. 等下一窗口处理
   - B. 立即回滚并升级事件
   - C. 只发邮件说明
   - D. 忽略

答案：1-B，2-C，3-B。

### 9.2 实作题

题目：为“服务助手”设计发布与回滚方案，至少包含：

1. 12条发布检查项。
2. 3条回滚触发条件。
3. 1份签字决策表。

评分参考：

1. 可执行性（40分）
2. 风险控制能力（40分）
3. 完整性（20分）

## 10. 验收标准（章节通过条件）

1. 输出发布清单+回滚方案+签字机制三件套。
2. 完成至少一次回滚演练记录。
3. 练习题得分 >= 80 分。

## 11. 参考资料

1. [../02-Build-HowTo/Deployment/Release-Checklist.md](../02-Build-HowTo/Deployment/Release-Checklist.md)
2. [../02-Build-HowTo/Setup/Agentforce-Implementation-Runbook.md](../02-Build-HowTo/Setup/Agentforce-Implementation-Runbook.md)
3. [../05-Observability/Incident-Runbook.md](../05-Observability/Incident-Runbook.md)
4. [../../../03-Roles/Architect/03-Checklists/GoLive-Readiness.md](../../../03-Roles/Architect/03-Checklists/GoLive-Readiness.md)

## 12. 版本敏感假设

1. 发布开关与配置入口可能随版本变化。
2. 不同组织的审批流程时序可能不同。

## Risks / Known Issues

1. 发布窗口外临时变更会显著增加回滚概率。
2. 多依赖系统同步发布时协调成本高。
3. 仅关注首小时，忽略24小时观察会漏掉延迟故障。

## Next Steps

1. 进入第11章，学习完整实战案例交付。
2. 将本章流程纳入团队标准发布SOP。
3. 将回滚演练改为季度常规动作。
